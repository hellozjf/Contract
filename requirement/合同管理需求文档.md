---
title: 合同管理需求文档
date: 2017-07-24 09:13:08
tags:
- 达索系统二次开发
- 合同管理
---

# 需求概述

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/合同管理需求概述.png)

由思维导出可以分析需求主要分为以下六大部分：编辑合同，编辑收款项，关联项目，合同流程控制，查看计划，报表导出。

<!-- more -->

# 编辑合同

## 合同属性字段

| 属性字段                         | 中文名称      | 类型   | 系统     | 备注                   |
| ---------------------------- | --------- | ---- | ------ | -------------------- |
| Bmbim_contract_id            | 合同编号      | 字符串  | string | 例如：GXJS-2006-S-10    |
| Bmbim_contract_name          | 合同名称      | 字符串  | string |                      |
| Bmbim_contract_state         | 合同状态      | 字符串  | string |                      |
| Bmbim_contract_signdate      | 我院签订时间    | 时间   | date   |                      |
| Bmbim_contract_clientsign    | 业主签订时间    | 时间   | date   |                      |
| Bmbim_contract_projectscale  | 建设规模      | 字符串  | string | 范围：重大项目，一般项目，零小项目    |
| Bmbim_contract_projectlevel  | 建设量级      | 字符串  | string |                      |
| Bmbim_contract_type          | 合同类型      | 字符串  | string | 范围：规划，测量，港口，航道，枢纽，其它 |
| Bmbim_contract_clientname    | 业主名称      | 字符串  | string |                      |
| Bmbim_contract_contact       | 业主联系人     | 字符串  | string |                      |
| Bmbim_contract_measure       | 测量（万元）    | 数值   | real   |                      |
| Bmbim_contract_geology       | 地质（万元）    | 数值   | real   |                      |
| Bmbim_contract_other         | 其它（万元）    | 数值   | real   |                      |
| Bmbim_contract_meetingcharge | 会务费（万元）   | 数值   | real   |                      |
| Bmbim_contract_totalamout    | 合同总金额（万元） | 数值   | real   |                      |
| Bmbim_contract_received      | 已收款（万元）   | 数值   | real   |                      |

## 区分已完成的合同

沈工要求，已完成的合同需要用不同的颜色将它们区分出来，以方便查看。

## 属性字段的公式

已收款（万元）=该合同下面所有收款项的实际收款金额（万元）的总和。

例如：一个合同下面有三个收款项，收款项1的实际收款总金额为5万元，收款项2的实际收款总金额为10万元，收款项3的实际收款总金额为15万元，那么该合同的已收款为30万元。

## 关于分包

目前没有太多的细节信息，猜测一个合同分成多个项目，每个项目都有一笔金额，这笔金额的一部分可能是外包出去的，也可能没有。

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724100934.png)

上图来自《空表2017.3.19.xlsx》汇总2。更多细节需要咨询沈工才能得到更多答案。

## 关于形象产值

目前没有太多的细节信息，我目前只知道有这样的情况，一个合同总金额是1万，但可能它的形象产值是100万。但是形象产值具体有什么用我就不知道了，它是否有相关的计算？我也不知道。更多细节需要咨询沈工才能得到更多答案。

# 编辑收款项

## 收款项属性字段

| 属性字段                         | 中文名称       | 类型   | 系统类型   | 备注                      |
| ---------------------------- | ---------- | ---- | ------ | ----------------------- |
| Bmbim_receipt_id             | 收款项编号      | 字符串  | string |                         |
| Bmbim_receipt_type           | 收款项类型      | 字符串  | string | 范围：预付款，送审稿，报批稿，交工，竣工，其它 |
| Bmbim_receipt_planmoney      | 计划收款金额（万元） | 数值   | real   |                         |
| Bmbim_receipt_plandate       | 计划收款时间     | 时间   | date   |                         |
| Bmbim_receipt_actualmoney    | 实际收款金额（万元） | 数值   | real   |                         |
| Bmbim_receipt_actualdate     | 实际收款时间     | 时间   | date   |                         |
| Bmbim_receipt_watertransport | 水运实收（万元）   | 数值   | real   |                         |
| Bmbim_receipt_headoffice     | 总公司（万元）    | 数值   | real   |                         |
| Bmbim_receipt_ground         | 岩土（万元）     | 数值   | real   |                         |
| Bmbim_receipt_plan           | 规划（万元）     | 数值   | real   |                         |
| Bmbim_receipt_echo           | 双象（万元）     | 数值   | real   |                         |
| Bmbim_receipt_building       | 建筑（万元）     | 数值   | real   |                         |
| Bmbim_receipt_remark         | 收款项备注      | 字符串  | string | 多行                      |
| Bmbim_receipt_invoice        | 发票备注       | 字符串  | string | 多行                      |

## 属性字段公式

实际收款金额（万元）=水运实收（万元）+总公司（万元）+岩土（万元）+规划（万元）+双象（万元）+建筑（万元）

## 计划收款的比例

收款分为预付款，送审稿，报批稿，交工，竣工，其它这六种类型。按照沈工的想法，在制定计划收款的时候，就能够让用户输入一个百分比，然后规定各个类型的比例，从而算出各个类型的实际金额。

例如一个100万的合同，预付款占20%，送审稿占10%，报批稿占10%，交工占15%，竣工占15%，其它占30%，那么最终算出来的结果就是预付款20万，送审稿10万，报批稿10万，交工15万，竣工15万，其它30万。

## 合同关联收款项

合同上要有一个按钮，点击之后才能进入收款项界面，该界面上的收款项操作只会影响相关联的合同，而不会对其它合同有影响。

# 关联项目

## 关联功能

项目是由项目管理模块进行操作的，所以我们的目标是通过一种方法，将合同与这些项目进行关联。关联好之后，操作这些项目只会对该合同有影响，而不会对其它合同产生影响。

## 所需要的属性字段

合同关联项目之后，项目管理模块里的项目本身有很多字段，但是我们实际需要的之后以下几个：

| 属性字段                          | 中文名称  | 类型   | 系统类型   | 备注                   |
| ----------------------------- | ----- | ---- | ------ | -------------------- |
| Bmbim_project_id              | 项目编号  | 字符串  | string |                      |
| Bmbim_project_name            | 项目名称  | 字符串  | string |                      |
| Bmbim_project_type            | 项目类型  | 字符串  | string | 范围：规划，测量，港口，航道，枢纽，其它 |
| Bmbim_project_manager         | 主管领导  | 字符串  | string |                      |
| Bmbim_project_leader          | 项目负责人 | 字符串  | string |                      |
| Bmbim_project_phase           | 项目阶段  | 字符串  | string |                      |
| Bmbim_project_starttime       | 开始时间  | 时间   | date   |                      |
| Bmbim_project_endtime         | 结束时间  | 时间   | date   |                      |
| Bmbim_project_totalpercentage | 总完成率  | 字符串  | string |                      |
| Bmbim_project_yearpercentage  | 今天完成率 | 字符串  | string |                      |
| Bmbim_project_remark          | 备注    | 字符串  | string |                      |

# 合同流程控制

合同状态：合同信息录入，分院领导传阅，总院领导传阅，业主传阅，合同正式签订，收款，结束。

其中分院领导传阅，总院领导传阅，业主传阅有权力否决合同通过，并使合同返回合同信息录入状态。

整个流程除了分院领导传阅，总院领导传阅，业主传阅外，没有其它分支。

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/合同状态切换.png)

## 合同关联合同流程控制

每个合同能够关联它自己的合同流程控制，并进行操作。对该合同流程的控制只会影响整个合同，而不会对其它合同产生影响。

## 合同状态显示图标

合同状态能够将完整的流程图显示给客户看，以便让客户清晰地了解合同进行到哪一步了。

## 通告相关领导审查合同

因为领导一般比较忙，可能压根不知道有合同需要他来审查，所以就需要有通告机制告知领导，让领导去审查合同，并进行批准或驳回操作。

## 通告项目负责人收款

按照沈工的想法，项目负责人希望合同正式签订之后，能够过7天通知他们去收预付款。

# 查看计划

## 创建计划

因为计划的时间是不固定的，可能是每年的12月15日为一个周期，也可能是12月10日为一个周期，所以需要通过制定特定的开始时间和结束时间来创建计划。

指定这个时间之后，就可以很灵活的实现计划的统计了。例如制定2015年12月11日到2016年12月15日为一个计划，那么2015年12月10日及以前和2016年12月16日及以后就不会被统计进去了。

## 所需要的属性字段

| 属性字段                              | 中文名称       | 类型   | 系统类型   | 备注   |
| --------------------------------- | ---------- | ---- | ------ | ---- |
| Bmbim_plan_id                     | 计划编号       | 字符串  | string |      |
| Bmbim_plan_starttime              | 计划开始时间     | 日期   | date   |      |
| Bmbim_plan_endtime                | 计划结束时间     | 日期   | date   |      |
| Bmbim_plan_totalamount            | 计划签订总额（万元） | 数值   | real   |      |
| Bmbim_plan_actualtotalamount      | 实际签订总额（万元） | 数值   | real   |      |
| Bmbim_plan_totalamountpercentage  | 签订完成率      | 数值   | real   |      |
| Bmbim_plan_totalpayment           | 计划收款总额（万元） | 数值   | real   |      |
| Bmbim_plan_actualtotalpayment     | 实际收款总额（万元） | 数值   | real   |      |
| Bmbim_plan_totalpaymentpercentage | 收款完成率      | 数值   | real   |      |

**注意：沈工要求计划签订总额，实际签订总额，签订完成率放在一块儿显示，计划收款总额，实际收款总额，收款完成率放在一块儿显示，以方便用户直观查看签订和收款情况。**

## 属性字段公式

### 实际签订总额

实际签订总额=我院签订时间处于开始时间和结束时间内的所有合同的合同总金额之和。

例如：有以下四个合同

| 合同编号 | 我院签订时间      | 合同总额 |
| ---- | ----------- | ---- |
| 1    | 2015年12月10日 | 5万   |
| 2    | 2015年12月11日 | 10万  |
| 3    | 2016年12月15日 | 15万  |
| 4    | 2016年12月16日 | 20万  |

如果计划开始时间设为2015年12月11日，计划结束时间设为2016年12月15日，则实际签订总额为25万。

如果计划开始时间设为2015年12月10日，计划结束时间设为2016年12月15日，则实际签订总额为30万。

如果计划开始时间设为2015年12月12日，计划结束时间设为2016年12月15日，则实际签订总额为15万。

### 实际收款总额

实际收款总额=我院签订时间处于开始时间和结束时间内的所有合同的已收款之和。

它的例子可以参照实际签订总额。

### 签订完成率

签订完成率=实际签订总额/计划签订总额。

### 收款完成率

收款完成率=实际收款总额/计划收款总额。

# 报表导出

按照目前的讨论结果，需要导出四张表格，分别是《主合同基本信息表》，《合同构成明细表》，《收款明细表》，《合同完成率表》。

## 《主合同基本信息表》

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724112903.png)

原始表格请参见《空表2017.3.19.xlsx》汇总1。

## 《合同构成明细表》

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724113059.png)

原始表格请参见《空表2017.3.19.xlsx》汇总2。

## 《收款明细表》

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724113220.png)

原始表格请参见《空表2017.3.19.xlsx》汇总4。

不过沈工貌似不满足现在的收款表，还要求增加收款的更多的细节，如下图所示：

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724120100.png)

我不知道到时候这两张表如何关联起来。

## 《合同完成率表》

![](http://ody3ivli2.bkt.clouddn.com/project/达索/20170724/TIM截图20170724113344.png)

原始表格请参见《空表2017.3.19.xlsx》汇总5。